<!DOCTYPE html>
<html>
    <head>
        <title>詮栩雲端資料庫</title>
        <meta charset="UTF-8">
        <!-- 響應式網站 -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Boostrap 導入程式 -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
        
        <!-- CSS設計 -->
            <!--<link rel="stylesheet" href="CS_cnc.css"> -->
            <style>
                body{

                    /*-- 背景顏色，網站:css gradient --*/
                    background: rgb(238,174,202);
                    background: radial-gradient(circle, rgba(238,174,202,1) 0%, rgba(148,187,233,1) 100%);
                
                }
                
                /*-- "container"表單容器 --*/
                .container{
                    /*background-color:rgb(158, 238, 243);*/
                    background: rgb(238,174,202);
                    background: radial-gradient(circle, rgba(238,174,202,1) 0%, rgba(148,187,233,1) 100%);
                    padding:50px; /*容器空間*/
                    margin-top:0px; /*網頁上空間*/
                    margin-bottom:0px; /*網頁下空間*/
                }
                
                h1{
                    text-align: center; /*文字置中*/
                    color:rgb(21, 21, 21);
                    padding:5px; /*空間*/
                    letter-spacing: 10px; /*文字間距*/
                }

                h2{
                    text-align: center; /*文字置中*/
                    color:rgb(21, 21, 21);
                    padding:5px; /*空間*/
                    /*letter-spacing: 3px;*/ /*文字間距*/
                }
                
                /*-- "label"設定 --*/
                label{
                    color:rgb(5, 88, 243);
                    font-size:22px; /*文字大小*/
                    font-weight:600; /*字體粗細100-900*/
                    letter-spacing: 3px; /*文字間距*/
                }
                
                
                /*-- "btn-success"按鈕設定 --*/
                .btn-primary{
                    /* background-color:rgb(43, 141, 48); */
                    width:100%;
                    font-size:22px;
                    padding:10px;
                }

                /*-- "btn-danger"按鈕設定 --*/
                .btn-danger{
                    /* background-color:rgb(43, 141, 48); */
                    width:100%;
                    font-size:22px;
                    padding:10px;
                }
                
                
                /*-- "container"裡面的"row"的"input"設定 --*/
                .container .row input{
                    font-size:22px;
                    color:rgb(0, 0, 0);
                    border:2px solid rgb(140, 9, 234); /*格子的邊線*/
                }
                
                /*-- container"裡面的"row"的"select"設定 --*/
                .container .row select{
                    font-size:22px;
                    color:rgb(0, 0, 0);
                    border:2px solid rgb(140, 9, 234); /*格子的邊線*/
                }

                /*-- container"裡面的"row"的"select"設定 --*/
                .container .row textarea{
                    font-size:20px;
                    color:rgb(0, 0, 0);
                    border:2px solid rgb(140, 9, 234); /*格子的邊線*/
                }

                /* 自訂彈出視窗「取消」按鈕樣式 */
                .btn-custom-cancel {
                    background-color: #6c757d; /* 深灰色 */
                    color: #ffffff; /* 白色字體 */
                    width:100%;
                }

                /* 自訂彈出視窗「確認」按鈕樣式 */
                .btn-custom-confirm {
                    background-color: #245aece7; /* 紅色 */
                    color: #ffffff; /* 白色字體 */
                    width:100%;
                }

                nav{
                    height: 50px;
                }

                @media (max-width:600px){
                    nav{
                        height: auto;
                    }
                }

                .container-fluid .navbar-brand{
                    font-size:20px;
                    color: #ffffff;
                }
                
                .navbar{
                    background-color: #7b7b7de7;
                }

                li a{
                    color: #ffffff !important;
                    font-size:18px;
                }

                li a:hover{
                    color: #2c0fe9 !important;
                    background-color: #ffffffe7;
                }

                .navbar-toggler{
                    background-color: #ffffffe7;
                }

                .nav-link{
                    /* 外距（與其他元素的間距） */
                    margin: 10px;

                    /* 內距（內容與邊框的距離） */
                    padding: 10px;
                }

                /*////////////////////////////////////////////////*/
                /* 調整表格邊框、欄與列的間距 */
                #resultTable {
                    width: 100%;
                    border-collapse: collapse; /* 使表格邊框合併 */
                    margin-top: 20px;
                }

                /* 表格標題列樣式 */
                #resultTable th {
                    padding: 12px 15px; /* 內邊距：上下12px，左右15px */
                    background-color: #f8f9fa; /* 淺灰色背景 */
                    border: 1px solid #ddd; /* 淺灰色邊框 */
                    text-align: center;
                }

                /* 表格資料列樣式 */
                #resultTable td {
                    padding: 10px 15px; /* 內邊距：上下10px，左右15px */
                    border: 1px solid #ddd; /* 淺灰色邊框 */
                    text-align: center;
                }

                /* 表格資料列的奇偶行交替顏色 */
                #resultTable tr:nth-child(even) {
                    background-color: #f2f2f2; /* 偶數行的背景顏色 */
                }

                /* 表格總數量行樣式 */
                #resultTable tr:last-child td {
                    font-weight: bold;
                    background-color: #fac400; /* 輕微藍色背景 */
                }

        </style>

    </head>

    <body>

        <!-- 分頁連結 -->
        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container-fluid">

                <a class="navbar-brand"> 詮栩雲端資料庫 ver.2 </a>

                <!-- 手機 -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
        
                <!-- 導航內容（折疊區域） -->
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="登記.html">加工數量登記</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="查詢.html">加工數量查詢</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>


        <div class="container">
            <form action="" id="myForm" onsubmit="getValues(event)">
                
                <h2> CNC加工數量查詢 </h2>
                <hr>
                <!-- hr--水平線 -->

                <!-- 第1列，日期 -->
                <div class="row">
                    <div class="col-sm-12">
                        <label>日期區間</label>
                        <input type="date" id="dt1" placeholder="YYYY/MM/DD" class="form-control" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <label>到</label>
                        <input type="date" id="dt2" placeholder="YYYY/MM/DD" class="form-control" required>
                    </div>
                </div>
                
                <br>

                <!-- 第3列，產品編號 -->
                <div class="row">
                    <div class="col-sm-12">
                        <label>產品編號</label>
                        <select id="pd" class="form-select" required></select>
                    </div>
                </div>

                <br>

                <!-- 第9列，送出 -->
                <div class="row">
                    <div class="col-sm-12">
                        <button type="submit" id="submitButton" class="btn btn-primary">
                            查詢
                        </button>
                    </div>
                </div>
            </form>
            <br>
            <table id="resultTable">
                <thead>
                    <tr>
                        <th>日期</th>
                        <th>產品編號</th>
                        <th>數量</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 查詢結果會顯示在這裡 -->
                </tbody>
            </table>

        </div>



        <!-- JavaScript程式 -->
        <script>
        // 在頁面載入時載入產品編號和機台
        window.onload = function() {
            // 載入產品編號
            google.script.run.withSuccessHandler(populateProductList).getProductList();
            
            // 確保表單提交事件綁定
            document.getElementById("myForm").addEventListener("submitButton", function(event) {
                getValues(event);
            });

            // 設定 dt1 和 dt2 為昨天的日期
            var today = new Date();
            var yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1); // 設定為昨天

            // 格式化為 YYYY-MM-DD 格式
            var formattedDate = yesterday.toISOString().split('T')[0];

            // 設定日期框的值
            document.getElementById("dt1").value = formattedDate;
            document.getElementById("dt2").value = formattedDate;
        };

        // 將產品編號選項加入下拉選單
        function populateProductList(data) {
            var pdSelect = document.getElementById("pd");

            // 加入一個空白選項作為初始值
            var emptyOption = document.createElement("option");
            emptyOption.value = "";
            emptyOption.text = "";
            pdSelect.appendChild(emptyOption);

            // 將從工作表抓取的產品編號加入選項
            data.forEach(function(item) {
                var option = document.createElement("option");
                option.value = item;
                option.text = item;
                pdSelect.appendChild(option);
            });
        }

        // getValues
        function getValues(event) {
            event.preventDefault(); // 防止表單的預設提交行為

            var dt1 = document.getElementById("dt1");
            var dt2 = document.getElementById("dt2");
            var pd = document.getElementById("pd");

            // 格式化日期為 YYYY/M/D
            var date1 = new Date(dt1.value);
            var formattedDate1 = date1.getFullYear() + '/' + (date1.getMonth() + 1) + '/' + date1.getDate();

            var date2 = new Date(dt2.value);
            var formattedDate2 = date2.getFullYear() + '/' + (date2.getMonth() + 1) + '/' + date2.getDate();

            // 檢查是否有填寫資料
            if (pd.value === "") {
                alert("資料不完整！");
                return; // 若值為空白，則停止程式執行
            }

            // 使用 google.script.run 呼叫 GAS 的 getRecordData 方法
            google.script.run.withSuccessHandler(displayRecordData).getRecordData(formattedDate1, formattedDate2, pd.value);
        }

        // 顯示查詢結果在表格中並加總數量
        function displayRecordData(data) {
            var table = document.getElementById("resultTable");
            var tbody = table.querySelector("tbody"); // 確保填充的是 <tbody> 部分
            tbody.innerHTML = ""; // 清空表格

            // 若沒有查詢結果，顯示訊息
            if (data.length === 0) {
                var noResult = document.createElement("tr");
                var td = document.createElement("td");
                td.colSpan = 3;
                td.textContent = "沒有符合條件的資料";
                noResult.appendChild(td);
                tbody.appendChild(noResult);
                return;
            }

            // 初始化數量加總
            var totalQuantity = 0;

            // 顯示查詢結果並加總數量
            data.forEach(function(row) {
                var tr = document.createElement("tr");

                // 每行遍歷資料
                row.forEach(function(cell, index) {
                    var td = document.createElement("td");
                    td.textContent = cell;
                    tr.appendChild(td);

                    // 若是數量欄（第三欄），則加總
                    if (index === 2) { // 假設數量在第三欄
                        totalQuantity += parseInt(cell) || 0; // 防止非數字情況，加上預設值0
                    }
                });

                tbody.appendChild(tr);
            });

            // 顯示總數量
            var totalRow = document.createElement("tr");
            var td = document.createElement("td");
            td.colSpan = 2; // 跨越兩個欄位
            td.textContent = "總數量";
            totalRow.appendChild(td);

            var totalCell = document.createElement("td");
            totalCell.textContent = totalQuantity; // 顯示總數量
            totalRow.appendChild(totalCell);

            tbody.appendChild(totalRow);
        }


        </script>
   
    </body>

    
</html>

